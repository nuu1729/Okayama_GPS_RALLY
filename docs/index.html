<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🏯 岡山GPS探索スタンプラリー</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff8c00">
  <link rel="icon" href="icons/icon-192.png">
</head>
<body>
  <!-- 言語切替 -->
  <div class="language-selector">
    <label for="languageSelect" class="lang-label">🌐 言語</label>
    <select id="languageSelect" onchange="changeLanguage()">
      <option value="ja">🇯🇵 日本語</option>
      <option value="en">🇺🇸 English</option>
      <option value="ko">🇰🇷 한국어</option>
      <option value="zh">🇨🇳 中文</option>
    </select>
  </div>

  <!-- ダークモード切替 -->
  <div class="theme-toggle">
    <label for="themeBtn" class="lang-label">🌓 テーマ</label>
    <select id="themeBtn">
      <option value="light">☀️ ライトモード</option>
      <option value="dark">🌙 ダークモード</option>
    </select>
  </div>


  <div class="container">
    <header class="header">
      <h1 id="appTitle">🏯 岡山GPS探索スタンプラリー</h1>

      <div class="controls">
        <div class="stamp-count"><span id="stampLabel">獲得スタンプ</span>：<strong id="stampCount">0</strong>/<span id="totalStamps">4</span></div>
        <div class="progress-bar" aria-hidden="true"><div id="progressFill" class="progress-fill" style="width:0%"></div></div>
        <div class="bgm-controls">
          <button id="playBGM" title="BGMを再生">PLAY</button>
          <button id="stopBGM" title="BGMを停止">STOP</button>
        </div>
      </div>
    </header>

    <!-- ナビゲーションタブ -->
    <nav class="nav-tabs">
      <button class="nav-tab active" id="tab-rally" onclick="switchTab('rally')">
        🎯 スタンプラリー
      </button>
      <button class="nav-tab" id="tab-collection" onclick="switchTab('collection')">
        📚 コレクション
      </button>
    </nav>

    <!-- スタンプラリー画面 -->
    <div id="rally-content" class="content-section active">
      <div id="statusMessage" class="status info" role="status" aria-live="polite" style="display:none;"></div>

      <main class="main-content" role="main">
        <!-- location 0 -->
        <article class="location-card" id="location-0" aria-labelledby="locname-0">
          <div class="location-header">
            <span class="stamp-icon" aria-hidden="true">🌳</span>
            <div class="location-info">
              <div id="locname-0" class="location-name">西古松南部公園</div>
              <div class="location-address">〒700-0973<br>岡山県岡山市北区下中野</div>
            </div>
          </div>
          <div id="distance-0" class="distance-info">距離を計算中...</div>
          <button class="check-button" id="checkBtn-0" onclick="checkLocation(0)">スタンプを獲得する</button>
        </article>

        <!-- location 1 -->
        <article class="location-card" id="location-1" aria-labelledby="locname-1">
          <div class="location-header">
            <span class="stamp-icon" aria-hidden="true">🌸</span>
            <div class="location-info">
              <div id="locname-1" class="location-name">大元東公園</div>
              <div class="location-address">〒700-0927<br>岡山県岡山市北区西古松250</div>
            </div>
          </div>
          <div id="distance-1" class="distance-info">距離を計算中...</div>
          <button class="check-button" id="checkBtn-1" onclick="checkLocation(1)">スタンプを獲得する</button>
        </article>

        <!-- location 2 -->
        <article class="location-card" id="location-2" aria-labelledby="locname-2">
          <div class="location-header">
            <span class="stamp-icon" aria-hidden="true">🏯</span>
            <div class="location-info">
              <div id="locname-2" class="location-name">岡山城</div>
              <div class="location-address">〒700-0823<br>岡山県岡山市北区丸の内2-3-1</div>
            </div>
          </div>
          <div id="distance-2" class="distance-info">距離を計算中...</div>
          <button class="check-button" id="checkBtn-2" onclick="checkLocation(2)">スタンプを獲得する</button>
        </article>

        <!-- location 3 -->
        <article class="location-card" id="location-3" aria-labelledby="locname-3">
          <div class="location-header">
            <span class="stamp-icon" aria-hidden="true">🌺</span>
            <div class="location-info">
              <div id="locname-3" class="location-name">岡山後楽園</div>
              <div class="location-address">〒703-8257<br>岡山県岡山市北区後楽園1-5</div>
            </div>
          </div>
          <div id="distance-3" class="distance-info">距離を計算中...</div>
          <button class="check-button" id="checkBtn-3" onclick="checkLocation(3)">スタンプを獲得する</button>
        </article>
      </main>
    </div>

    <div id="map" style="height:400px; margin-top:20px; border-radius:12px; overflow:hidden;"></div>

    <!-- コレクション画面 -->
    <div id="collection-content" class="content-section">
      <div class="collection-grid" id="collectionGrid">
        <!-- コレクションカードはJavaScriptで生成 -->
      </div>
    </div>

    <footer class="footer">
      <div id="footerText">位置情報を有効にして、指定地点に近づこう！</div>
    </footer>
    
    <!-- Leaflet CSS and JS for map functionality -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <!-- デバッグ切替 -->
    <div class="debug-toggle">
      <button id="debugBtn" class="debug-btn" onclick="toggleDebug()">🐞 デバッグモード切替</button>
      
      <div id="debug-buttons" class="debug-controls" style="display:none;">
        <button class="debug-sub-btn" onclick="showCurrentPosition()">📍 現在地表示</button>
        <button class="debug-sub-btn" onclick="debugMarkAll()">✅ 全て獲得</button>
        <button class="debug-sub-btn" onclick="debugClearAll()">🗑️ 全てクリア</button>
      </div>
    </div>
  </div>

  <!-- audio elements -->
  <div class="audio-elements" aria-hidden="true">
    <audio id="bgm" src="Sounds/BGM.mp3" loop preload="auto"></audio>
  </div>

  <script src="script.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js")
          .then(reg => console.log("Service Worker registered:", reg))
          .catch(err => console.error("Service Worker registration failed:", err));
      });
    }
  </script>
</body>
</html>