# GPS ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã‚¢ãƒ—ãƒª ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

## ğŸ“‹ æ–‡æ›¸æ¦‚è¦

**æ–‡æ›¸ç¨®åˆ¥**: è©³ç´°è¨­è¨ˆæ›¸  
**ä½œæˆç›®çš„**: SEæ¥­å‹™å§”è¨—ã«ãŠã‘ã‚‹æ©Ÿèƒ½å®Ÿè£…ä»•æ§˜ã®æ˜ç¢ºåŒ–  
**å¯¾è±¡èª­è€…**: ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼  
**å‰æçŸ¥è­˜**: JavaScript, HTML/CSS, REST API ã®åŸºç¤çŸ¥è­˜  

---

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ¦‚è¦

### 1.1 å§”è¨—è¦ä»¶æ¦‚è¦
```
é¡§å®¢è¦æ±‚:
ã€Œå²¡å±±çœŒã®è¦³å…‰åœ°ã‚’å·¡ã‚‹GPSã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ãŸã„ã€‚
 å®Ÿéš›ã«ç¾åœ°ã«è¡Œã‹ãªã„ã¨ã‚¹ã‚¿ãƒ³ãƒ—ãŒå–ã‚Œãªã„ã‚·ã‚¹ãƒ†ãƒ ã§ã€
 å¤–å›½äººè¦³å…‰å®¢ã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†å¤šè¨€èªæ©Ÿèƒ½ãŒå¿…è¦ã€‚
 ã‚¹ãƒãƒ›ã§æ°—è»½ã«ä½¿ãˆã‚‹Webã‚¢ãƒ—ãƒªã«ã—ã¦ã»ã—ã„ã€‚ã€

æŠ€è¡“è¦ä»¶:
- GPSä½ç½®æƒ…å ±é€£å‹•
- å¤šè¨€èªå¯¾å¿œï¼ˆæ—¥è‹±éŸ“ä¸­ï¼‰
- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æœ€é©åŒ–
- PWAå¯¾å¿œï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³åˆ©ç”¨å¯èƒ½ï¼‰
```

### 1.2 æ©Ÿèƒ½åˆ†è§£ãƒ»å„ªå…ˆåº¦è¨­å®š

| æ©Ÿèƒ½ID | æ©Ÿèƒ½å | è©³ç´°è¦ä»¶ | å„ªå…ˆåº¦ | å·¥æ•°è¦‹ç© |
|--------|--------|----------|---------|----------|
| **F001** | GPSä½ç½®æ¤œå‡ºãƒ»è·é›¢è¨ˆç®— | ç¾åœ¨åœ°å–å¾—ã€è¦³å…‰åœ°ã¨ã®è·é›¢ç®—å‡º | **é«˜** | 3æ—¥ |
| **F002** | ã‚¹ã‚¿ãƒ³ãƒ—ç²å¾—åˆ¤å®š | æŒ‡å®šç¯„å›²å†…ã§ã®ç²å¾—å‡¦ç† | **é«˜** | 2æ—¥ |
| **F003** | å¤šè¨€èªåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ | 4è¨€èªå¯¾å¿œãƒ»UIå‹•çš„å¤‰æ›´ | **é«˜** | 2æ—¥ |
| **F004** | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åœ°å›³è¡¨ç¤º | ç¾åœ¨åœ°ãƒ»ç›®çš„åœ°å¯è¦–åŒ– | ä¸­ | 2æ—¥ |
| **F005** | ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† | ç²å¾—çŠ¶æ³è¡¨ç¤ºãƒ»æ°¸ç¶šåŒ– | ä¸­ | 2æ—¥ |
| **F006** | PWAæ©Ÿèƒ½ | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œãƒ»ã‚¢ãƒ—ãƒªåŒ– | ä½ | 1æ—¥ |

**ç·å·¥æ•°è¦‹ç©**: 12æ—¥é–“ï¼ˆè¨­è¨ˆãƒ»ãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰

---

## ğŸ”§ æ ¸å¿ƒæ©Ÿèƒ½ã®è©³ç´°è¨­è¨ˆ

## æ©Ÿèƒ½F003: å¤šè¨€èªåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

### 2.1 æ©Ÿèƒ½ä»•æ§˜

#### è¦ä»¶å®šç¾©
```
é¡§å®¢è¦æ±‚:
ã€Œæ—¥æœ¬èªã€è‹±èªã€éŸ“å›½èªã€ä¸­å›½èªã®4è¨€èªã«å¯¾å¿œã—ã€
 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸè¨€èªã§ã‚¢ãƒ—ãƒªå…¨ä½“ãŒå³åº§ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã“ã¨ã€‚
 é¸æŠã—ãŸè¨€èªã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ä¿æŒã•ã‚Œã‚‹ã“ã¨ã€‚ã€

å—ã‘å…¥ã‚Œæ¡ä»¶:
âœ… è¨€èªé¸æŠUIã‹ã‚‰4è¨€èªã‚’é¸æŠå¯èƒ½
âœ… é¸æŠå¾Œã€å…¨UIè¦ç´ ãŒå³åº§ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
âœ… ãƒ–ãƒ©ã‚¦ã‚¶å†èµ·å‹•å¾Œã‚‚é¸æŠçŠ¶æ…‹ã‚’ç¶­æŒ
âœ… è¦³å…‰åœ°åãƒ»ä½æ‰€ã‚‚å¯¾å¿œè¨€èªã§è¡¨ç¤º
```

#### æŠ€è¡“ä»•æ§˜
```typescript
// ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©
interface TranslationData {
  [languageCode: string]: {
    [textKey: string]: string
  }
}

interface LocationName {
  ja: string
  en: string  
  ko: string
  zh: string
}

// çŠ¶æ…‹ç®¡ç†
let currentLanguage: string = 'ja'  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥æœ¬èª
const supportedLanguages = ['ja', 'en', 'ko', 'zh']
```

### 2.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

#### ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
graph TD
    A[ã‚¢ãƒ—ãƒªèµ·å‹•] --> B[ä¿å­˜ã•ã‚ŒãŸè¨€èªè¨­å®šã‚’ç¢ºèª]
    B --> C{ä¿å­˜ãƒ‡ãƒ¼ã‚¿æœ‰ã‚Šï¼Ÿ}
    C -->|Yes| D[ä¿å­˜è¨€èªã‚’ currentLanguage ã«è¨­å®š]
    C -->|No| E[ãƒ–ãƒ©ã‚¦ã‚¶è¨€èªã‚’ç¢ºèª]
    E --> F[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªè¨­å®š ja]
    D --> G[è¨€èªé¸æŠUIã‚’åˆæœŸåŒ–]
    F --> G
    G --> H[ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨]
    H --> I[ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾…æ©Ÿ]
    
    I --> J[è¨€èªé¸æŠå¤‰æ›´]
    J --> K[changeLanguage é–¢æ•°å®Ÿè¡Œ]
    K --> L[æ–°è¨€èªã§UIæ›´æ–°]
    L --> M[é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜]
    M --> I
```

### 2.3 é–¢æ•°è¨­è¨ˆä»•æ§˜

#### é–¢æ•°1: `initializeLanguageSystem()`
```typescript
/**
 * è¨€èªã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
 * ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹
 */
function initializeLanguageSystem(): void {
  // 1. ä¿å­˜æ¸ˆã¿è¨€èªè¨­å®šã‚’ç¢ºèª
  const savedLanguage = getSavedLanguage()
  
  // 2. æœ‰åŠ¹ãªè¨€èªã‚³ãƒ¼ãƒ‰ã‹ãƒã‚§ãƒƒã‚¯
  if (savedLanguage && supportedLanguages.includes(savedLanguage)) {
    currentLanguage = savedLanguage
  } else {
    // 3. ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨€èªè¨­å®šã‚’ç¢ºèª
    const browserLang = navigator.language.substring(0, 2)
    currentLanguage = supportedLanguages.includes(browserLang) ? browserLang : 'ja'
  }
  
  // 4. è¨€èªé¸æŠUIã«åæ˜ 
  const languageSelect = document.getElementById('languageSelect') as HTMLSelectElement
  if (languageSelect) {
    languageSelect.value = currentLanguage
  }
  
  // 5. åˆå›ç¿»è¨³é©ç”¨
  applyTranslations()
}

/**
 * å‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°: DOMContentLoaded ã‚¤ãƒ™ãƒ³ãƒˆæ™‚
 * å‰ææ¡ä»¶: HTMLè¦ç´ ãŒå…¨ã¦èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨
 * æˆ»ã‚Šå€¤: ãªã—
 */
```

#### é–¢æ•°2: `changeLanguage(newLanguage: string)`
```typescript
/**
 * è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒ¡ã‚¤ãƒ³å‡¦ç†
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨€èªã‚’é¸æŠã—ãŸéš›ã«å®Ÿè¡Œ
 */
function changeLanguage(newLanguage?: string): void {
  // 1. å¼•æ•°ãƒã‚§ãƒƒã‚¯ï¼ˆUIè¦ç´ ã‹ã‚‰ã®å–å¾—ã‚‚å¯¾å¿œï¼‰
  if (!newLanguage) {
    const selectElement = document.getElementById('languageSelect') as HTMLSelectElement
    newLanguage = selectElement?.value || 'ja'
  }
  
  // 2. æœ‰åŠ¹ãªè¨€èªã‚³ãƒ¼ãƒ‰ã‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!supportedLanguages.includes(newLanguage)) {
    console.warn(`Unsupported language: ${newLanguage}`)
    return
  }
  
  // 3. ç¾åœ¨ã®è¨€èªã¨åŒã˜å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (currentLanguage === newLanguage) {
    return
  }
  
  // 4. è¨€èªåˆ‡ã‚Šæ›¿ãˆå®Ÿè¡Œ
  currentLanguage = newLanguage
  
  // 5. å…¨UIè¦ç´ ã‚’æ–°è¨€èªã§æ›´æ–°
  applyTranslations()
  
  // 6. è¦³å…‰åœ°ãƒ‡ãƒ¼ã‚¿ã‚‚è¨€èªå¯¾å¿œã§æ›´æ–°
  updateLocationNames()
  
  // 7. ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢ã‚‚æ›´æ–°ï¼ˆè¡¨ç¤ºä¸­ã®å ´åˆï¼‰
  if (isCollectionTabActive()) {
    updateCollectionDisplay()
  }
  
  // 8. è¨€èªé¸æŠã‚’æ°¸ç¶šåŒ–
  saveLanguagePreference(newLanguage)
}

/**
 * å‘¼ã³å‡ºã—å…ƒ: 
 * - onchange="changeLanguage()" (HTML)
 * - JavaScript ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
 * 
 * å¼•æ•°:
 * - newLanguage: åˆ‡ã‚Šæ›¿ãˆå…ˆè¨€èªã‚³ãƒ¼ãƒ‰
 * 
 * å‰¯ä½œç”¨:
 * - currentLanguage ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°æ›´æ–°
 * - DOMè¦ç´ ã®ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹å¤‰æ›´
 * - localStorage ã¸ã®ä¿å­˜
 */
```

#### é–¢æ•°3: `applyTranslations()`
```typescript
/**
 * ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã‚’DOMè¦ç´ ã«é©ç”¨
 * ç”»é¢ä¸Šã®å…¨ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã‚’ç¾åœ¨è¨€èªã§æ›´æ–°
 */
function applyTranslations(): void {
  // 1. ç¿»è¨³å¯¾è±¡è¦ç´ ã®ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©
  const translationMapping = [
    { elementId: 'appTitle', textKey: 'appTitle' },
    { elementId: 'stampLabel', textKey: 'stampLabel' },
    { elementId: 'footerText', textKey: 'footerText' },
    { elementId: 'tab-rally', textKey: 'tabRally' },
    { elementId: 'tab-collection', textKey: 'tabCollection' },
    // ... ãã®ä»–ã®ç¿»è¨³å¯¾è±¡è¦ç´ 
  ]
  
  // 2. å„è¦ç´ ã«ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’é©ç”¨
  translationMapping.forEach(mapping => {
    const element = document.getElementById(mapping.elementId)
    if (element) {
      const translatedText = getText(mapping.textKey)
      element.textContent = translatedText
    }
  })
  
  // 3. ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ›´æ–°
  updateButtonTexts()
  
  // 4. ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã®æ›´æ–°
  updatePlaceholders()
}

/**
 * å‘¼ã³å‡ºã—å…ƒ: changeLanguage(), initializeLanguageSystem()
 * å‰ææ¡ä»¶: currentLanguage ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
 * å‡¦ç†å¯¾è±¡: å›ºå®šãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã®ã¿ï¼ˆå‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯åˆ¥å‡¦ç†ï¼‰
 */
```

#### é–¢æ•°4: `getText(key: string, params?: object)`
```typescript
/**
 * ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 * ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç½®æ›ã‚‚ã‚µãƒãƒ¼ãƒˆ
 */
function getText(key: string, params: Record<string, string> = {}): string {
  // 1. ç¾åœ¨è¨€èªã®ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const currentTranslations = translations[currentLanguage]
  
  // 2. è©²å½“ã‚­ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
  let text = currentTranslations?.[key] || 
             translations['ja']?.[key] || 
             `[Missing: ${key}]`
  
  // 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ç½®æ›å‡¦ç†
  if (Object.keys(params).length > 0) {
    Object.entries(params).forEach(([paramKey, paramValue]) => {
      const placeholder = `{${paramKey}}`
      text = text.replace(new RegExp(placeholder, 'g'), paramValue)
    })
  }
  
  return text
}

/**
 * ä½¿ç”¨ä¾‹:
 * getText('stampAcquired', { name: 'å²¡å±±åŸ' })
 * â†’ "ğŸ‰ å²¡å±±åŸã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆï¼"
 * 
 * å¼•æ•°:
 * - key: ç¿»è¨³ã‚­ãƒ¼ï¼ˆtranslations ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ¼ï¼‰
 * - params: ç½®æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
 * 
 * æˆ»ã‚Šå€¤: ç¿»è¨³æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç½®æ›æ¸ˆã¿ï¼‰
 */
```

#### é–¢æ•°5: `updateLocationNames()`
```typescript
/**
 * è¦³å…‰åœ°åã®è¨€èªå¯¾å¿œæ›´æ–°
 * å„è¦³å…‰åœ°ã‚«ãƒ¼ãƒ‰ã®åç§°ã‚’ç¾åœ¨è¨€èªã§è¡¨ç¤º
 */
function updateLocationNames(): void {
  // 1. å…¨è¦³å…‰åœ°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ«ãƒ¼ãƒ—
  locations.forEach((location, index) => {
    // 2. å¯¾å¿œã™ã‚‹ DOMè¦ç´ ã‚’å–å¾—
    const nameElement = document.getElementById(`locname-${index}`)
    
    if (nameElement && location.name) {
      // 3. ç¾åœ¨è¨€èªã®åç§°ã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
      const localizedName = location.name[currentLanguage] || 
                           location.name['ja'] || 
                           'åç§°ä¸æ˜'
      
      // 4. DOMè¦ç´ ã‚’æ›´æ–°
      nameElement.textContent = localizedName
    }
  })
  
  // 5. åœ°å›³ãƒãƒ¼ã‚«ãƒ¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚‚æ›´æ–°
  if (map && markers) {
    markers.forEach((marker, index) => {
      const location = locations[index]
      if (location && marker) {
        const localizedName = location.name[currentLanguage] || location.name['ja']
        marker.setPopupContent(`<b>${localizedName}</b><br>${location.address}`)
      }
    })
  }
}

/**
 * å‘¼ã³å‡ºã—å…ƒ: changeLanguage()
 * å‰ææ¡ä»¶: 
 * - locations é…åˆ—ãŒåˆæœŸåŒ–æ¸ˆã¿
 * - DOMè¦ç´ ãŒå­˜åœ¨
 * æ›´æ–°å¯¾è±¡:
 * - è¦³å…‰åœ°ã‚«ãƒ¼ãƒ‰ã®åç§°
 * - åœ°å›³ãƒãƒ¼ã‚«ãƒ¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
 */
```

### 2.4 ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

#### ç¿»è¨³ãƒ‡ãƒ¼ã‚¿å®šç¾©
```typescript
/**
 * ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨å®šç¾©
 * æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã“ã“ã‚’æ›´æ–°
 */
const translations: TranslationData = {
  ja: {
    // ã‚¢ãƒ—ãƒªåŸºæœ¬æƒ…å ±
    appTitle: "ğŸ¯ å²¡å±±GPSæ¢ç´¢ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼",
    stampLabel: "é›†ã‚ãŸã‚¹ã‚¿ãƒ³ãƒ—", 
    footerText: "ä½ç½®æƒ…å ±ã‚’ã‚ªãƒ³ã«ã—ã¦ã€ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã«è¡Œã“ã†ï¼",
    
    // ã‚¿ãƒ–ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    tabRally: "ğŸ¯ ãƒ©ãƒªãƒ¼",
    tabCollection: "ğŸ“š ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³",
    
    // ã‚¹ã‚¿ãƒ³ãƒ—é–¢é€£
    getStamp: "ã‚¹ã‚¿ãƒ³ãƒ—ã‚²ãƒƒãƒˆï¼",
    acquired: "âœ“ ã‚²ãƒƒãƒˆæ¸ˆã¿",
    calculating: "è·é›¢ã‚’è¨ˆç®—ä¸­â€¦",
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãï¼‰
    stampAcquired: "ğŸ‰ {name}ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆï¼",
    needApproach: "ã‚ã¨{distance}mè¿‘ã¥ã„ã¦ã­",
    distance: "ç¾åœ¨åœ°ã‹ã‚‰ã®è·é›¢: {distance}",
    
    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    locationError: "ä½ç½®æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­â€¦ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­",
    permissionDenied: "ä½ç½®æƒ…å ±ãŒã‚ªãƒ•ã«ãªã£ã¦ã‚‹ã¿ãŸã„ã€‚è¨­å®šã§ã‚ªãƒ³ã«ã—ã¦ã­",
    
    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
    notAcquired: "ã¾ã ã‚²ãƒƒãƒˆã—ã¦ãªã„ã‚ˆ",
    allComplete: "ğŸŠ å…¨éƒ¨é›†ã‚ãŸã‚ˆï¼ãŠã‚ã§ã¨ã†ï¼"
  },
  
  en: {
    appTitle: "ğŸ¯ Okayama GPS Stamp Rally",
    stampLabel: "Your Stamps",
    footerText: "Turn on location and head to the spots!",
    
    tabRally: "ğŸ¯ Rally", 
    tabCollection: "ğŸ“š Collection",
    
    getStamp: "Get Stamp!",
    acquired: "âœ“ Got it",
    calculating: "Checking distanceâ€¦",
    
    stampAcquired: "ğŸ‰ You got {name} stamp!",
    needApproach: "Move {distance}m closer", 
    distance: "Distance: {distance}",
    
    locationError: "Loading locationâ€¦ please wait",
    permissionDenied: "Location is off. Please turn it on in settings.",
    
    notAcquired: "Not collected yet",
    allComplete: "ğŸŠ Congrats! You got all the stamps!"
  },
  
  ko: {
    // éŸ“å›½èªç¿»è¨³ãƒ‡ãƒ¼ã‚¿
    // ... å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’éŸ“å›½èªã§å®šç¾©
  },
  
  zh: {
    // ä¸­å›½èªç¿»è¨³ãƒ‡ãƒ¼ã‚¿  
    // ... å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å›½èªã§å®šç¾©
  }
}

/**
 * ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ãƒã‚¤ãƒ³ãƒˆ:
 * - éšå±¤åŒ–: language > textKey > text
 * - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¯¾å¿œ: {paramName} å½¢å¼ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
 * - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æ—¥æœ¬èªã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªã¨ã—ã¦è¨­å®š
 * - æ‹¡å¼µæ€§: æ–°è¨€èªãƒ»æ–°ãƒ†ã‚­ã‚¹ãƒˆã®è¿½åŠ ãŒå®¹æ˜“
 */
```

#### è¦³å…‰åœ°ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```typescript
/**
 * å¤šè¨€èªå¯¾å¿œè¦³å…‰åœ°ãƒ‡ãƒ¼ã‚¿
 * ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‹ã‚‰å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼
 */
interface StampLocation {
  id: number
  name: LocalizedString  // å¤šè¨€èªå¯¾å¿œ
  address: string        // ä½æ‰€ã¯æ—¥æœ¬èªå›ºå®š
  lat: number           // ç·¯åº¦
  lng: number           // çµŒåº¦  
  radius: number        // åˆ¤å®šåŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
  image: string         // ç”»åƒãƒ‘ã‚¹
  icon: string          // çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³
}

interface LocalizedString {
  ja: string  // æ—¥æœ¬èªï¼ˆå¿…é ˆï¼‰
  en: string  // è‹±èªï¼ˆå¿…é ˆï¼‰
  ko: string  // éŸ“å›½èªï¼ˆå¿…é ˆï¼‰ 
  zh: string  // ä¸­å›½èªï¼ˆå¿…é ˆï¼‰
}

/**
 * ãƒ‡ãƒ¼ã‚¿ä¾‹:
 */
const locationData: StampLocation = {
  id: 0,
  name: {
    ja: "è¥¿å¤æ¾å—éƒ¨å…¬åœ’",
    en: "Nishikomatsu Nanbu Park", 
    ko: "ë‹ˆì‹œì½”ë§ˆì¸  ë‚¨ë¶€ê³µì›",
    zh: "è¥¿å¤æ¾å—éƒ¨å…¬å›­"
  },
  address: "ã€’700-0973 å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºä¸‹ä¸­é‡",
  lat: 34.6433,
  lng: 133.9053,
  radius: 100,
  image: "images/location-0.jpg",
  icon: "ğŸŒ³"
}
```

### 2.5 æ°¸ç¶šåŒ–è¨­è¨ˆ

#### ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä»•æ§˜
```typescript
/**
 * è¨€èªè¨­å®šã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
 */

// ä¿å­˜å‡¦ç†
function saveLanguagePreference(language: string): void {
  try {
    const settingsData = {
      language: language,
      savedAt: new Date().toISOString()
    }
    
    localStorage.setItem('stampRallyLanguage', language)
    localStorage.setItem('stampRallySettings', JSON.stringify(settingsData))
    
    console.log(`Language preference saved: ${language}`)
  } catch (error) {
    console.warn('Failed to save language preference:', error)
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ¡ãƒ¢ãƒªå¤‰æ•°ã«ä¿å­˜
    window.tempLanguageSetting = language
  }
}

// èª­ã¿è¾¼ã¿å‡¦ç†  
function getSavedLanguage(): string | null {
  try {
    // æœ€åˆã«å˜ç´”ãªã‚­ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
    const simpleValue = localStorage.getItem('stampRallyLanguage')
    if (simpleValue && supportedLanguages.includes(simpleValue)) {
      return simpleValue
    }
    
    // è©³ç´°è¨­å®šã‚‚ãƒã‚§ãƒƒã‚¯
    const settingsJson = localStorage.getItem('stampRallySettings')
    if (settingsJson) {
      const settings = JSON.parse(settingsJson)
      if (settings.language && supportedLanguages.includes(settings.language)) {
        return settings.language
      }
    }
    
    return null
  } catch (error) {
    console.warn('Failed to load language preference:', error)
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ¡ãƒ¢ãƒªå¤‰æ•°ã‹ã‚‰å–å¾—
    return window.tempLanguageSetting || null
  }
}

/**
 * ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:
 * - localStorage ãŒä½¿ãˆãªã„ç’°å¢ƒã¸ã®å¯¾å¿œ
 * - JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã¸ã®å¯¾å¿œ
 * - ä¸æ­£ãªè¨€èªã‚³ãƒ¼ãƒ‰ã®é™¤å¤–
 */
```

### 2.6 UIé€£å‹•è¨­è¨ˆ

#### HTMLæ§‹é€ è¦æ±‚
```html
<!-- è¨€èªé¸æŠUI -->
<div class="language-selector">
  <label for="languageSelect" class="lang-label">ğŸŒ è¨€èª</label>
  <select id="languageSelect" onchange="changeLanguage()">
    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
  </select>
</div>

<!-- ç¿»è¨³å¯¾è±¡è¦ç´ ï¼ˆIDã«ã‚ˆã‚‹è­˜åˆ¥ãŒå¿…é ˆï¼‰ -->
<h1 id="appTitle">[Title]</h1>
<span id="stampLabel">[Label]</span>
<div id="footerText">[Footer]</div>

<!-- è¦³å…‰åœ°åï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã«ã‚ˆã‚‹è­˜åˆ¥ï¼‰ -->
<div id="locname-0">[Location Name]</div>
<div id="locname-1">[Location Name]</div>
```

#### CSSè¦æ±‚ä»•æ§˜
```css
/**
 * è¨€èªã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼èª¿æ•´
 * å„è¨€èªã«é©ã—ãŸãƒ•ã‚©ãƒ³ãƒˆã‚’æŒ‡å®š
 */
html[lang="ja"] {
  font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
}

html[lang="en"] {
  font-family: "Helvetica Neue", Arial, sans-serif;
}

html[lang="ko"] {
  font-family: "Malgun Gothic", "Apple SD Gothic Neo", sans-serif;
}

html[lang="zh"] {
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
}

/**
 * RTLè¨€èªå¯¾å¿œï¼ˆå°†æ¥çš„ãªã‚¢ãƒ©ãƒ“ã‚¢èªå¯¾å¿œæ™‚ï¼‰
 */
html[dir="rtl"] .language-selector {
  direction: rtl;
  text-align: right;
}

/**
 * è¨€èªé¸æŠUIã®ã‚¹ã‚¿ã‚¤ãƒ«
 */
.language-selector {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.language-selector select {
  padding: 6px 10px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}
```

---

## æ©Ÿèƒ½F001: GPSä½ç½®æ¤œå‡ºãƒ»è·é›¢è¨ˆç®—

### 3.1 æ©Ÿèƒ½ä»•æ§˜

#### è¦ä»¶å®šç¾©
```
é¡§å®¢è¦æ±‚:
ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã‚’æ­£ç¢ºã«å–å¾—ã—ã€4ã¤ã®è¦³å…‰åœ°ãã‚Œãã‚Œã¾ã§ã®
 è·é›¢ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã—ãŸã„ã€‚è·é›¢ã¯åˆ†ã‹ã‚Šã‚„ã™ããƒ¡ãƒ¼ãƒˆãƒ«ã¾ãŸã¯
 ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«å˜ä½ã§è¡¨ç¤ºã—ã€å¸¸ã«æœ€æ–°ã®ä½ç½®ã§æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã€‚ã€

æŠ€è¡“è¦ä»¶:
âœ… HTML5 Geolocation APIä½¿ç”¨
âœ… é«˜ç²¾åº¦ãƒ¢ãƒ¼ãƒ‰ï¼ˆenableHighAccuracy: trueï¼‰
âœ… ä½ç½®æƒ…å ±ã®é€£ç¶šç›£è¦–ï¼ˆwatchPositionï¼‰
âœ… Haversineå…¬å¼ã«ã‚ˆã‚‹è·é›¢è¨ˆç®—
âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆæ¨©é™æ‹’å¦ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾å¿œï¼‰
```

### 3.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

```mermaid
graph TD
    A[ã‚¢ãƒ—ãƒªèµ·å‹•] --> B[GPSæ©Ÿèƒ½ã®åˆ©ç”¨å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯]
    B --> C{Geolocation APIå¯¾å¿œï¼Ÿ}
    C -->|No| D[ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼šGPSéå¯¾å¿œ]
    C -->|Yes| E[ä½ç½®æƒ…å ±ã®è¨±å¯è¦æ±‚]
    E --> F{ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨±å¯ï¼Ÿ}
    F -->|æ‹’å¦| G[ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼šè¨±å¯ãŒå¿…è¦]
    F -->|è¨±å¯| H[watchPositioné–‹å§‹]
    H --> I[ä½ç½®æƒ…å ±å–å¾—æˆåŠŸ]
    I --> J[ç²¾åº¦ãƒã‚§ãƒƒã‚¯]
    J --> K{ç²¾åº¦100mä»¥å†…ï¼Ÿ}
    K -->|No| L[è­¦å‘Šè¡¨ç¤ºï¼šç²¾åº¦ä½ä¸‹]
    K -->|Yes| M[è·é›¢è¨ˆç®—å®Ÿè¡Œ]
    M --> N[å…¨è¦³å…‰åœ°ã¨ã®è·é›¢æ›´æ–°]
    N --> O[UIè¡¨ç¤ºæ›´æ–°]
    O --> P[æ¬¡ã®ä½ç½®æ›´æ–°ã‚’å¾…æ©Ÿ]
    P --> I
    
    % ã‚¨ãƒ©ãƒ¼å‡¦ç†
    H --> Q[ä½ç½®å–å¾—ã‚¨ãƒ©ãƒ¼]
    Q --> R[ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥åˆ¤å®š]
    R --> S[é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
    S --> T[5ç§’å¾Œã«ãƒªãƒˆãƒ©ã‚¤]
    T --> H
```

### 3.3 é–¢æ•°è¨­è¨ˆä»•æ§˜

#### é–¢æ•°1: `startLocationTracking()`
```typescript
/**
 * GPSä½ç½®ç›£è¦–ã®é–‹å§‹
 * ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ä¸€åº¦ã ã‘å‘¼ã³å‡ºã•ã‚Œã‚‹åˆæœŸåŒ–é–¢æ•°
 */
function startLocationTracking(): void {
  // 1. Geolocation API ã®å¯¾å¿œç¢ºèª
  if (!navigator.geolocation) {
    showStatus(getText('geolocationNotSupported'), 'error')
    return
  }
  
  // 2. GPSè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³
  const options: PositionOptions = {
    enableHighAccuracy: true,  // é«˜ç²¾åº¦ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»å¤§ï¼‰
    timeout: 10000,           // 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    maximumAge: 30000         // 30ç§’é–“ã¯å‰å›ã®å€¤ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  }
  
  // 3. ä½ç½®ç›£è¦–ã®é–‹å§‹
  watchId = navigator.geolocation.watchPosition(
    onLocationSuccess,        // æˆåŠŸæ™‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    onLocationError,         // ã‚¨ãƒ©ãƒ¼æ™‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯  
    options                  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
  )
  
  // 4. åˆæœŸçŠ¶æ…‹è¡¨ç¤º
  showStatus(getText('locationLoading'), 'info')
  
  console.log('GPS tracking started with watchId:', watchId)
}

/**
 * å‘¼ã³å‡ºã—å…ƒ: DOMContentLoaded ã‚¤ãƒ™ãƒ³ãƒˆ
 * å‰ææ¡ä»¶: DOMè¦ç´ ãŒèª­ã¿è¾¼ã¿å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨
 * å‰¯ä½œç”¨: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° watchId ã®è¨­å®š
 */
```

#### é–¢æ•°2: `onLocationSuccess(position: GeolocationPosition)`
```typescript
/**
 * ä½ç½®æƒ…å ±å–å¾—æˆåŠŸæ™‚ã®å‡¦ç†
 * GPSåº§æ¨™ã‚’å—ã‘å–ã‚Šã€ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã‚’æ›´æ–°
 */
function onLocationSuccess(position: GeolocationPosition): void {
  // 1. ä½ç½®æƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«æ ¼ç´
  currentPosition = {
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    accuracy: position.coords.accuracy,
    timestamp: position.timestamp
  }
  
  // 2. ç²¾åº¦ãƒã‚§ãƒƒã‚¯ã¨çŠ¶æ…‹è¡¨ç¤º
  if (position.coords.accuracy < 100) {
    clearStatus()  // ç²¾åº¦ãŒååˆ†ãªå ´åˆã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆå»
  } else {
    showStatus(getText('lowAccuracy', { 
      accuracy: Math.round(position.coords.accuracy) 
    }), 'warning')
  }
  
  // 3. è·é›¢è¨ˆç®—ã¨UIæ›´æ–°
  updateAllDistances()
  
  // 4. åœ°å›³ã®ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼æ›´æ–°
  updateCurrentLocationMarker()
  
  // 5. ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
  if (debugMode) {
    console.log('Position updated:', {
      lat: currentPosition.lat,
      lng: currentPosition.lng, 
      accuracy: position.coords.accuracy
    })
  }
}

/**
 * å‘¼ã³å‡ºã—å…ƒ: navigator.geolocation.watchPosition
 * å¼•æ•°: GeolocationPosition ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * å‡¦ç†é »åº¦: GPSæ›´æ–°ã«å¿œã˜ã¦æ•°ç§’ï½æ•°åç§’é–“éš”
 */
```

#### é–¢æ•°3: `calculateDistance(lat1, lng1, lat2, lng2)`
```typescript
/**
 * 2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆHaversineå…¬å¼ï¼‰
 * åœ°çƒã‚’çƒä½“ã¨ã¿ãªã—ãŸå ´åˆã®æœ€çŸ­è·é›¢ã‚’ç®—å‡º
 */
function calculateDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {
  const R = 6371000  // åœ°çƒã®åŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
  
  // 1. ç·¯åº¦å·®ãƒ»çµŒåº¦å·®ã‚’ãƒ©ã‚¸ã‚¢ãƒ³ã«å¤‰æ›
  const dLat = toRadians(lat2 - lat1)
  const dLng = toRadians(lng2 - lng1)
  
  // 2. Haversineå…¬å¼ã®è¨ˆç®—
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
           Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
           Math.sin(dLng / 2) * Math.sin(dLng / 2)
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
  
  // 3. è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ã‚’è¿”ã™
  const distance = R * c
  
  return distance
}

/**
 * è£œåŠ©é–¢æ•°: åº¦ã‹ã‚‰ãƒ©ã‚¸ã‚¢ãƒ³ã¸ã®å¤‰æ›
 */
function toRadians(degrees: number): number {
  return degrees * (Math.PI / 180)
}

/**
 * æ•°å­¦çš„èƒŒæ™¯:
 * Haversineå…¬å¼ã¯çƒé¢ä¸‰è§’æ³•ã‚’ç”¨ã„ã¦ã€åœ°çƒè¡¨é¢ä¸Šã®
 * 2ç‚¹é–“ã®æœ€çŸ­è·é›¢ï¼ˆå¤§å††è·é›¢ï¼‰ã‚’è¨ˆç®—ã™ã‚‹å…¬å¼
 * 
 * ç²¾åº¦: æ•°ãƒ¡ãƒ¼ãƒˆãƒ«ç¨‹åº¦ã®èª¤å·®
 * é©ç”¨ç¯„å›²: åœ°çƒä¸Šã®ã‚ã‚‰ã‚†ã‚‹2ç‚¹ï¼ˆæ¥µåœ°å«ã‚€ï¼‰
 * 
 * å¼•æ•°:
 * - lat1, lng1: åœ°ç‚¹1ã®ç·¯åº¦ãƒ»çµŒåº¦ï¼ˆåº¦ï¼‰
 * - lat2, lng2: åœ°ç‚¹2ã®ç·¯åº¦ãƒ»çµŒåº¦ï¼ˆåº¦ï¼‰
 * 
 * æˆ»ã‚Šå€¤: è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
 */
```